<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.1">
    <meta name="project" content="Axon v0.6.1">


    <title>Model hooks — Axon v0.6.1</title>
    <link rel="stylesheet" href="dist/html-elixir-FM2CSD74.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-B66D7C0E.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-L4O5OK2K.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<div class="background-layer"></div>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="Axon.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Axon" />
        </a>

      <div>
        <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.6.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Axon</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <div class="autocomplete">
          </div>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>

      </div>

<h1>

    <a href="https://github.com/elixir-nx/axon/blob/v0.6.1/guides/model_creation/model_hooks.livemd#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Model hooks</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="1839711964-1">(</span><span class="p" data-group-id="1839711964-2">[</span><span class="w">
  </span><span class="p" data-group-id="1839711964-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="1839711964-3">}</span><span class="w">
</span><span class="p" data-group-id="1839711964-2">]</span><span class="p" data-group-id="1839711964-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="creating-models-with-hooks" class="section-heading">
  <a href="#creating-models-with-hooks" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Creating models with hooks</span>
</h2>
<p>Sometimes it's useful to inspect or visualize the values of intermediate layers in your model during the forward or backward pass. For example, it's common to visualize the gradients of activation functions to ensure your model is learning in a stable manner. Axon supports this functionality via model hooks.</p><p>Model hooks are a means of unidirectional communication with an executing model. Hooks are unidirectional in the sense that you can only <strong>receive</strong> information from your model, and not send information back.</p><p>Hooks are attached per-layer and can execute at 4 different points in model execution: on the pre-forward, forward, or backward pass of the model or during model initialization. You can also configure the same hook to execute on all 3 events. You can attach hooks to models using <a href="Axon.html#attach_hook/3"><code class="inline">Axon.attach_hook/3</code></a>:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="7911382978-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="7911382978-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="7911382978-2">(</span><span class="mi">8</span><span class="p" data-group-id="7911382978-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="7911382978-3">(</span><span class="k" data-group-id="7911382978-4">fn</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="7911382978-5">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="ss">:dense_forward</span><span class="p" data-group-id="7911382978-5">)</span><span class="w"> </span><span class="k" data-group-id="7911382978-4">end</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:forward</span><span class="p" data-group-id="7911382978-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="7911382978-6">(</span><span class="k" data-group-id="7911382978-7">fn</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="7911382978-8">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="ss">:dense_init</span><span class="p" data-group-id="7911382978-8">)</span><span class="w"> </span><span class="k" data-group-id="7911382978-7">end</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:initialize</span><span class="p" data-group-id="7911382978-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="7911382978-9">(</span><span class="p" data-group-id="7911382978-9">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="7911382978-10">(</span><span class="k" data-group-id="7911382978-11">fn</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="7911382978-12">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="7911382978-12">)</span><span class="w"> </span><span class="k" data-group-id="7911382978-11">end</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:forward</span><span class="p" data-group-id="7911382978-10">)</span><span class="w">

</span><span class="p" data-group-id="7911382978-13">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="7911382978-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="7911382978-14">(</span><span class="n">model</span><span class="p" data-group-id="7911382978-14">)</span><span class="w">

</span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">iota</span><span class="p" data-group-id="7911382978-15">(</span><span class="p" data-group-id="7911382978-16">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="7911382978-16">}</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:f32</span><span class="p" data-group-id="7911382978-15">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="7911382978-17">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7911382978-18">%{</span><span class="p" data-group-id="7911382978-18">}</span><span class="p" data-group-id="7911382978-17">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">dense_init</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5553427462-1">%{</span><span class="w">
  </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="5553427462-2">#</span><span class="nc" data-group-id="5553427462-2">Nx.Tensor</span><span class="p" data-group-id="5553427462-2">&lt;</span><span class="w">
    </span><span class="n">f32</span><span class="p" data-group-id="5553427462-3">[</span><span class="mi">8</span><span class="p" data-group-id="5553427462-3">]</span><span class="w">
    </span><span class="p" data-group-id="5553427462-4">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="5553427462-4">]</span><span class="w">
  </span><span class="p" data-group-id="5553427462-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="5553427462-5">#</span><span class="nc" data-group-id="5553427462-5">Nx.Tensor</span><span class="p" data-group-id="5553427462-5">&lt;</span><span class="w">
    </span><span class="n">f32</span><span class="p" data-group-id="5553427462-6">[</span><span class="mi">4</span><span class="p" data-group-id="5553427462-6">]</span><span class="p" data-group-id="5553427462-7">[</span><span class="mi">8</span><span class="p" data-group-id="5553427462-7">]</span><span class="w">
    </span><span class="p" data-group-id="5553427462-8">[</span><span class="w">
      </span><span class="p" data-group-id="5553427462-9">[</span><span class="mf">0.6067318320274353</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5483129620552063</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05663269758224487</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.48249542713165283</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.18357598781585693</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6496620774269104</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4919115900993347</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.08380156755447388</span><span class="p" data-group-id="5553427462-9">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="5553427462-10">[</span><span class="o">-</span><span class="mf">0.19745409488677979</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10483592748641968</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.43387970328330994</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1041460633277893</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4129607081413269</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6482449769973755</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6696910262107849</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4690167307853699</span><span class="p" data-group-id="5553427462-10">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="5553427462-11">[</span><span class="o">-</span><span class="mf">0.18194729089736938</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4856645464897156</span><span class="p">,</span><span class="w"> </span><span class="mf">0.39400774240493774</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.28496378660202026</span><span class="p">,</span><span class="w"> </span><span class="mf">0.32120805978775024</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.41854584217071533</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5671316981315613</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.21937215328216553</span><span class="p" data-group-id="5553427462-11">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="5553427462-12">[</span><span class="mf">0.4516749978065491</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.23585206270217896</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6682141423225403</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4286096692085266</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.14930623769760132</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3825327157974243</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2700549364089966</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3888852596282959</span><span class="p" data-group-id="5553427462-12">]</span><span class="w">
    </span><span class="p" data-group-id="5553427462-8">]</span><span class="w">
  </span><span class="p" data-group-id="5553427462-5">&gt;</span><span class="w">
</span><span class="p" data-group-id="5553427462-1">}</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3464809643-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3464809643-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3464809643-3">#</span><span class="nc" data-group-id="3464809643-3">Nx.Tensor</span><span class="p" data-group-id="3464809643-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3464809643-4">[</span><span class="mi">8</span><span class="p" data-group-id="3464809643-4">]</span><span class="w">
      </span><span class="p" data-group-id="3464809643-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3464809643-5">]</span><span class="w">
    </span><span class="p" data-group-id="3464809643-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3464809643-6">#</span><span class="nc" data-group-id="3464809643-6">Nx.Tensor</span><span class="p" data-group-id="3464809643-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3464809643-7">[</span><span class="mi">4</span><span class="p" data-group-id="3464809643-7">]</span><span class="p" data-group-id="3464809643-8">[</span><span class="mi">8</span><span class="p" data-group-id="3464809643-8">]</span><span class="w">
      </span><span class="p" data-group-id="3464809643-9">[</span><span class="w">
        </span><span class="p" data-group-id="3464809643-10">[</span><span class="mf">0.6067318320274353</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5483129620552063</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05663269758224487</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.48249542713165283</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.18357598781585693</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6496620774269104</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4919115900993347</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.08380156755447388</span><span class="p" data-group-id="3464809643-10">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3464809643-11">[</span><span class="o">-</span><span class="mf">0.19745409488677979</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10483592748641968</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.43387970328330994</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1041460633277893</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4129607081413269</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6482449769973755</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6696910262107849</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4690167307853699</span><span class="p" data-group-id="3464809643-11">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3464809643-12">[</span><span class="o">-</span><span class="mf">0.18194729089736938</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4856645464897156</span><span class="p">,</span><span class="w"> </span><span class="mf">0.39400774240493774</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.28496378660202026</span><span class="p">,</span><span class="w"> </span><span class="mf">0.32120805978775024</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.41854584217071533</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5671316981315613</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.21937215328216553</span><span class="p" data-group-id="3464809643-12">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3464809643-13">[</span><span class="mf">0.4516749978065491</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.23585206270217896</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6682141423225403</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4286096692085266</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.14930623769760132</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3825327157974243</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2700549364089966</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3888852596282959</span><span class="p" data-group-id="3464809643-13">]</span><span class="w">
      </span><span class="p" data-group-id="3464809643-9">]</span><span class="w">
    </span><span class="p" data-group-id="3464809643-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="3464809643-2">}</span><span class="w">
</span><span class="p" data-group-id="3464809643-1">}</span></code></pre><p>Notice how during initialization the <code class="inline">:dense_init</code> hook fired and inspected the layer's parameters. Now when executing, you'll see outputs for <code class="inline">:dense</code> and <code class="inline">:relu</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="3857657534-1">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="3857657534-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">relu</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0486160299-1">#</span><span class="nc" data-group-id="0486160299-1">Nx.Tensor</span><span class="p" data-group-id="0486160299-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0486160299-2">[</span><span class="mi">2</span><span class="p" data-group-id="0486160299-2">]</span><span class="p" data-group-id="0486160299-3">[</span><span class="mi">8</span><span class="p" data-group-id="0486160299-3">]</span><span class="w">
  </span><span class="p" data-group-id="0486160299-4">[</span><span class="w">
    </span><span class="p" data-group-id="0486160299-5">[</span><span class="mf">0.7936763167381287</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.61175537109375</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.614119291305542</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="0486160299-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0486160299-6">[</span><span class="mf">3.5096981525421143</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">10.609275817871094</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="0486160299-6">]</span><span class="w">
  </span><span class="p" data-group-id="0486160299-4">]</span><span class="w">
</span><span class="p" data-group-id="0486160299-1">&gt;</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="4755274651-1">#</span><span class="nc" data-group-id="4755274651-1">Nx.Tensor</span><span class="p" data-group-id="4755274651-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="4755274651-2">[</span><span class="mi">2</span><span class="p" data-group-id="4755274651-2">]</span><span class="p" data-group-id="4755274651-3">[</span><span class="mi">8</span><span class="p" data-group-id="4755274651-3">]</span><span class="w">
  </span><span class="p" data-group-id="4755274651-4">[</span><span class="w">
    </span><span class="p" data-group-id="4755274651-5">[</span><span class="mf">0.7936763167381287</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.61175537109375</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.614119291305542</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="4755274651-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4755274651-6">[</span><span class="mf">3.5096981525421143</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">10.609275817871094</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="4755274651-6">]</span><span class="w">
  </span><span class="p" data-group-id="4755274651-4">]</span><span class="w">
</span><span class="p" data-group-id="4755274651-1">&gt;</span></code></pre><p>It's important to note that hooks execute in the order they were attached to a layer. If you attach 2 hooks to the same layer which execute different functions on the same event, they will run in order:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="2700669273-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="2700669273-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="2700669273-2">(</span><span class="mi">8</span><span class="p" data-group-id="2700669273-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="2700669273-3">(</span><span class="k" data-group-id="2700669273-4">fn</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="2700669273-5">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="ss">:hook1</span><span class="p" data-group-id="2700669273-5">)</span><span class="w"> </span><span class="k" data-group-id="2700669273-4">end</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:forward</span><span class="p" data-group-id="2700669273-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="2700669273-6">(</span><span class="k" data-group-id="2700669273-7">fn</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="2700669273-8">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="ss">:hook2</span><span class="p" data-group-id="2700669273-8">)</span><span class="w"> </span><span class="k" data-group-id="2700669273-7">end</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:forward</span><span class="p" data-group-id="2700669273-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="2700669273-9">(</span><span class="p" data-group-id="2700669273-9">)</span><span class="w">

</span><span class="p" data-group-id="2700669273-10">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="2700669273-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="2700669273-11">(</span><span class="n">model</span><span class="p" data-group-id="2700669273-11">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="2700669273-12">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2700669273-13">%{</span><span class="p" data-group-id="2700669273-13">}</span><span class="p" data-group-id="2700669273-12">)</span><span class="w">

</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="2700669273-14">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="2700669273-14">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">hook2</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3743044295-1">#</span><span class="nc" data-group-id="3743044295-1">Nx.Tensor</span><span class="p" data-group-id="3743044295-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="3743044295-2">[</span><span class="mi">2</span><span class="p" data-group-id="3743044295-2">]</span><span class="p" data-group-id="3743044295-3">[</span><span class="mi">8</span><span class="p" data-group-id="3743044295-3">]</span><span class="w">
  </span><span class="p" data-group-id="3743044295-4">[</span><span class="w">
    </span><span class="p" data-group-id="3743044295-5">[</span><span class="o">-</span><span class="mf">0.6567458510398865</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2303993701934814</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.540865421295166</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.873536229133606</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.386439085006714</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.248870849609375</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.9092607498168945</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1976098120212555</span><span class="p" data-group-id="3743044295-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3743044295-6">[</span><span class="mf">2.4088101387023926</span><span class="p">,</span><span class="w"> </span><span class="mf">5.939034461975098</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.024522066116333</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">7.58249568939209</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">10.193460464477539</span><span class="p">,</span><span class="w"> </span><span class="mf">0.33839887380599976</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">10.836882591247559</span><span class="p">,</span><span class="w"> </span><span class="mf">1.8173918724060059</span><span class="p" data-group-id="3743044295-6">]</span><span class="w">
  </span><span class="p" data-group-id="3743044295-4">]</span><span class="w">
</span><span class="p" data-group-id="3743044295-1">&gt;</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9373005455-1">#</span><span class="nc" data-group-id="9373005455-1">Nx.Tensor</span><span class="p" data-group-id="9373005455-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="9373005455-2">[</span><span class="mi">2</span><span class="p" data-group-id="9373005455-2">]</span><span class="p" data-group-id="9373005455-3">[</span><span class="mi">8</span><span class="p" data-group-id="9373005455-3">]</span><span class="w">
  </span><span class="p" data-group-id="9373005455-4">[</span><span class="w">
    </span><span class="p" data-group-id="9373005455-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2303993701934814</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="9373005455-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9373005455-6">[</span><span class="mf">2.4088101387023926</span><span class="p">,</span><span class="w"> </span><span class="mf">5.939034461975098</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.33839887380599976</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.8173918724060059</span><span class="p" data-group-id="9373005455-6">]</span><span class="w">
  </span><span class="p" data-group-id="9373005455-4">]</span><span class="w">
</span><span class="p" data-group-id="9373005455-1">&gt;</span></code></pre><p>Notice that <code class="inline">:hook1</code> fires before <code class="inline">:hook2</code>.</p><p>You can also specify a hook to fire on all events:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="3148779465-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="3148779465-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="3148779465-2">(</span><span class="mi">8</span><span class="p" data-group-id="3148779465-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="3148779465-3">(</span><span class="o">&amp;</span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:all</span><span class="p" data-group-id="3148779465-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="3148779465-4">(</span><span class="p" data-group-id="3148779465-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="3148779465-5">(</span><span class="mi">1</span><span class="p" data-group-id="3148779465-5">)</span><span class="w">

</span><span class="p" data-group-id="3148779465-6">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="3148779465-6">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="3148779465-7">(</span><span class="n">model</span><span class="p" data-group-id="3148779465-7">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0842399239-1">{</span><span class="p" data-group-id="0842399239-2">#</span><span class="nc" data-group-id="0842399239-2">Function</span><span class="p" data-group-id="0842399239-2">&lt;</span><span class="mf">135.109794929</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Nx.Defn.Compiler</span><span class="o">.</span><span class="n">fun</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="0842399239-2">&gt;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0842399239-3">#</span><span class="nc" data-group-id="0842399239-3">Function</span><span class="p" data-group-id="0842399239-3">&lt;</span><span class="mf">135.109794929</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Nx.Defn.Compiler</span><span class="o">.</span><span class="n">fun</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="0842399239-3">&gt;</span><span class="p" data-group-id="0842399239-1">}</span></code></pre><p>On initialization:</p><pre><code class="makeup elixir" translate="no"><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="6468369004-1">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6468369004-2">%{</span><span class="p" data-group-id="6468369004-2">}</span><span class="p" data-group-id="6468369004-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6849791410-1">%{</span><span class="w">
  </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6849791410-2">#</span><span class="nc" data-group-id="6849791410-2">Nx.Tensor</span><span class="p" data-group-id="6849791410-2">&lt;</span><span class="w">
    </span><span class="n">f32</span><span class="p" data-group-id="6849791410-3">[</span><span class="mi">8</span><span class="p" data-group-id="6849791410-3">]</span><span class="w">
    </span><span class="p" data-group-id="6849791410-4">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="6849791410-4">]</span><span class="w">
  </span><span class="p" data-group-id="6849791410-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6849791410-5">#</span><span class="nc" data-group-id="6849791410-5">Nx.Tensor</span><span class="p" data-group-id="6849791410-5">&lt;</span><span class="w">
    </span><span class="n">f32</span><span class="p" data-group-id="6849791410-6">[</span><span class="mi">4</span><span class="p" data-group-id="6849791410-6">]</span><span class="p" data-group-id="6849791410-7">[</span><span class="mi">8</span><span class="p" data-group-id="6849791410-7">]</span><span class="w">
    </span><span class="p" data-group-id="6849791410-8">[</span><span class="w">
      </span><span class="p" data-group-id="6849791410-9">[</span><span class="mf">0.2199305295944214</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05434012413024902</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07989239692687988</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4456246793270111</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2792319655418396</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1601254940032959</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6115692853927612</span><span class="p">,</span><span class="w"> </span><span class="mf">0.37740427255630493</span><span class="p" data-group-id="6849791410-9">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6849791410-10">[</span><span class="o">-</span><span class="mf">0.3606935739517212</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6091846823692322</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3203054368495941</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6252920031547546</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.41500264406204224</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.20729252696037292</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6763507127761841</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6776859164237976</span><span class="p" data-group-id="6849791410-10">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6849791410-11">[</span><span class="mf">0.659041702747345</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.615885317325592</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.45865312218666077</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18774819374084473</span><span class="p">,</span><span class="w"> </span><span class="mf">0.31994110345840454</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3055777847766876</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3537192642688751</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4297131896018982</span><span class="p" data-group-id="6849791410-11">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6849791410-12">[</span><span class="mf">0.06112170219421387</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13321959972381592</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5566524863243103</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1115691065788269</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3557875156402588</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.03118818998336792</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5788122415542603</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6988758444786072</span><span class="p" data-group-id="6849791410-12">]</span><span class="w">
    </span><span class="p" data-group-id="6849791410-8">]</span><span class="w">
  </span><span class="p" data-group-id="6849791410-5">&gt;</span><span class="w">
</span><span class="p" data-group-id="6849791410-1">}</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6421795960-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-3">#</span><span class="nc" data-group-id="6421795960-3">Nx.Tensor</span><span class="p" data-group-id="6421795960-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6421795960-4">[</span><span class="mi">8</span><span class="p" data-group-id="6421795960-4">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="6421795960-5">]</span><span class="w">
    </span><span class="p" data-group-id="6421795960-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-6">#</span><span class="nc" data-group-id="6421795960-6">Nx.Tensor</span><span class="p" data-group-id="6421795960-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6421795960-7">[</span><span class="mi">4</span><span class="p" data-group-id="6421795960-7">]</span><span class="p" data-group-id="6421795960-8">[</span><span class="mi">8</span><span class="p" data-group-id="6421795960-8">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-9">[</span><span class="w">
        </span><span class="p" data-group-id="6421795960-10">[</span><span class="mf">0.2199305295944214</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05434012413024902</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07989239692687988</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4456246793270111</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2792319655418396</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1601254940032959</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6115692853927612</span><span class="p">,</span><span class="w"> </span><span class="mf">0.37740427255630493</span><span class="p" data-group-id="6421795960-10">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-11">[</span><span class="o">-</span><span class="mf">0.3606935739517212</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6091846823692322</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3203054368495941</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6252920031547546</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.41500264406204224</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.20729252696037292</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6763507127761841</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6776859164237976</span><span class="p" data-group-id="6421795960-11">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-12">[</span><span class="mf">0.659041702747345</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.615885317325592</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.45865312218666077</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18774819374084473</span><span class="p">,</span><span class="w"> </span><span class="mf">0.31994110345840454</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3055777847766876</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3537192642688751</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4297131896018982</span><span class="p" data-group-id="6421795960-12">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-13">[</span><span class="mf">0.06112170219421387</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13321959972381592</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5566524863243103</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1115691065788269</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3557875156402588</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.03118818998336792</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5788122415542603</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6988758444786072</span><span class="p" data-group-id="6421795960-13">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-9">]</span><span class="w">
    </span><span class="p" data-group-id="6421795960-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6421795960-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-14">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-15">#</span><span class="nc" data-group-id="6421795960-15">Nx.Tensor</span><span class="p" data-group-id="6421795960-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6421795960-16">[</span><span class="mi">1</span><span class="p" data-group-id="6421795960-16">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-17">[</span><span class="mf">0.0</span><span class="p" data-group-id="6421795960-17">]</span><span class="w">
    </span><span class="p" data-group-id="6421795960-15">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6421795960-18">#</span><span class="nc" data-group-id="6421795960-18">Nx.Tensor</span><span class="p" data-group-id="6421795960-18">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6421795960-19">[</span><span class="mi">8</span><span class="p" data-group-id="6421795960-19">]</span><span class="p" data-group-id="6421795960-20">[</span><span class="mi">1</span><span class="p" data-group-id="6421795960-20">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-21">[</span><span class="w">
        </span><span class="p" data-group-id="6421795960-22">[</span><span class="mf">0.3259686231613159</span><span class="p" data-group-id="6421795960-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-23">[</span><span class="mf">0.4874255657196045</span><span class="p" data-group-id="6421795960-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-24">[</span><span class="mf">0.6338149309158325</span><span class="p" data-group-id="6421795960-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-25">[</span><span class="mf">0.4437469244003296</span><span class="p" data-group-id="6421795960-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-26">[</span><span class="o">-</span><span class="mf">0.22870665788650513</span><span class="p" data-group-id="6421795960-26">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-27">[</span><span class="mf">0.8108665943145752</span><span class="p" data-group-id="6421795960-27">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-28">[</span><span class="mf">7.919073104858398e-4</span><span class="p" data-group-id="6421795960-28">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6421795960-29">[</span><span class="mf">0.4469025135040283</span><span class="p" data-group-id="6421795960-29">]</span><span class="w">
      </span><span class="p" data-group-id="6421795960-21">]</span><span class="w">
    </span><span class="p" data-group-id="6421795960-18">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6421795960-14">}</span><span class="w">
</span><span class="p" data-group-id="6421795960-1">}</span></code></pre><p>On pre-forward and forward:</p><pre><code class="makeup elixir" translate="no"><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="7649288232-1">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="7649288232-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7135347695-1">#</span><span class="nc" data-group-id="7135347695-1">Nx.Tensor</span><span class="p" data-group-id="7135347695-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="7135347695-2">[</span><span class="mi">2</span><span class="p" data-group-id="7135347695-2">]</span><span class="p" data-group-id="7135347695-3">[</span><span class="mi">4</span><span class="p" data-group-id="7135347695-3">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-4">[</span><span class="w">
    </span><span class="p" data-group-id="7135347695-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p" data-group-id="7135347695-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7135347695-6">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">,</span><span class="w"> </span><span class="mf">7.0</span><span class="p" data-group-id="7135347695-6">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-4">]</span><span class="w">
</span><span class="p" data-group-id="7135347695-1">&gt;</span><span class="w">
</span><span class="p" data-group-id="7135347695-7">#</span><span class="nc" data-group-id="7135347695-7">Nx.Tensor</span><span class="p" data-group-id="7135347695-7">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="7135347695-8">[</span><span class="mi">2</span><span class="p" data-group-id="7135347695-8">]</span><span class="p" data-group-id="7135347695-9">[</span><span class="mi">8</span><span class="p" data-group-id="7135347695-9">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-10">[</span><span class="w">
    </span><span class="p" data-group-id="7135347695-11">[</span><span class="mf">1.1407549381256104</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.22292715311050415</span><span class="p">,</span><span class="w"> </span><span class="mf">0.43234577775001526</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5845029354095459</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.8424829840660095</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9120126962661743</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.1202259063720703</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.9148870706558228</span><span class="p" data-group-id="7135347695-11">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7135347695-12">[</span><span class="mf">3.4583563804626465</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06578820943832397</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.776448130607605</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.563453197479248</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7628071308135986</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7287485599517822</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">12.002032279968262</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.19266414642334</span><span class="p" data-group-id="7135347695-12">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-10">]</span><span class="w">
</span><span class="p" data-group-id="7135347695-7">&gt;</span><span class="w">
</span><span class="p" data-group-id="7135347695-13">#</span><span class="nc" data-group-id="7135347695-13">Nx.Tensor</span><span class="p" data-group-id="7135347695-13">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="7135347695-14">[</span><span class="mi">2</span><span class="p" data-group-id="7135347695-14">]</span><span class="p" data-group-id="7135347695-15">[</span><span class="mi">8</span><span class="p" data-group-id="7135347695-15">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-16">[</span><span class="w">
    </span><span class="p" data-group-id="7135347695-17">[</span><span class="mf">1.1407549381256104</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.22292715311050415</span><span class="p">,</span><span class="w"> </span><span class="mf">0.43234577775001526</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5845029354095459</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.8424829840660095</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9120126962661743</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.1202259063720703</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.9148870706558228</span><span class="p" data-group-id="7135347695-17">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7135347695-18">[</span><span class="mf">3.4583563804626465</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06578820943832397</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.776448130607605</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.563453197479248</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7628071308135986</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7287485599517822</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">12.002032279968262</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.19266414642334</span><span class="p" data-group-id="7135347695-18">]</span><span class="w">
  </span><span class="p" data-group-id="7135347695-16">]</span><span class="w">
</span><span class="p" data-group-id="7135347695-13">&gt;</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="2016019550-1">#</span><span class="nc" data-group-id="2016019550-1">Nx.Tensor</span><span class="p" data-group-id="2016019550-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="2016019550-2">[</span><span class="mi">2</span><span class="p" data-group-id="2016019550-2">]</span><span class="p" data-group-id="2016019550-3">[</span><span class="mi">1</span><span class="p" data-group-id="2016019550-3">]</span><span class="w">
  </span><span class="p" data-group-id="2016019550-4">[</span><span class="w">
    </span><span class="p" data-group-id="2016019550-5">[</span><span class="mf">0.6458775401115417</span><span class="p" data-group-id="2016019550-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2016019550-6">[</span><span class="mf">1.1593825817108154</span><span class="p" data-group-id="2016019550-6">]</span><span class="w">
  </span><span class="p" data-group-id="2016019550-4">]</span><span class="w">
</span><span class="p" data-group-id="2016019550-1">&gt;</span></code></pre><p>And on backwards:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">grad</span><span class="p" data-group-id="2355659834-1">(</span><span class="k" data-group-id="2355659834-2">fn</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="2355659834-3">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="2355659834-3">)</span><span class="w"> </span><span class="k" data-group-id="2355659834-2">end</span><span class="p" data-group-id="2355659834-1">)</span><span class="o">.</span><span class="p" data-group-id="2355659834-4">(</span><span class="n">params</span><span class="p" data-group-id="2355659834-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0183751064-1">#</span><span class="nc" data-group-id="0183751064-1">Nx.Tensor</span><span class="p" data-group-id="0183751064-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0183751064-2">[</span><span class="mi">2</span><span class="p" data-group-id="0183751064-2">]</span><span class="p" data-group-id="0183751064-3">[</span><span class="mi">4</span><span class="p" data-group-id="0183751064-3">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-4">[</span><span class="w">
    </span><span class="p" data-group-id="0183751064-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p" data-group-id="0183751064-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0183751064-6">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">,</span><span class="w"> </span><span class="mf">7.0</span><span class="p" data-group-id="0183751064-6">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-4">]</span><span class="w">
</span><span class="p" data-group-id="0183751064-1">&gt;</span><span class="w">
</span><span class="p" data-group-id="0183751064-7">#</span><span class="nc" data-group-id="0183751064-7">Nx.Tensor</span><span class="p" data-group-id="0183751064-7">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0183751064-8">[</span><span class="mi">2</span><span class="p" data-group-id="0183751064-8">]</span><span class="p" data-group-id="0183751064-9">[</span><span class="mi">8</span><span class="p" data-group-id="0183751064-9">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-10">[</span><span class="w">
    </span><span class="p" data-group-id="0183751064-11">[</span><span class="mf">1.1407549381256104</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.22292715311050415</span><span class="p">,</span><span class="w"> </span><span class="mf">0.43234577775001526</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5845029354095459</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.8424829840660095</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9120126962661743</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.1202259063720703</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.9148870706558228</span><span class="p" data-group-id="0183751064-11">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0183751064-12">[</span><span class="mf">3.4583563804626465</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06578820943832397</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.776448130607605</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.563453197479248</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7628071308135986</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7287485599517822</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">12.002032279968262</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.19266414642334</span><span class="p" data-group-id="0183751064-12">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-10">]</span><span class="w">
</span><span class="p" data-group-id="0183751064-7">&gt;</span><span class="w">
</span><span class="p" data-group-id="0183751064-13">#</span><span class="nc" data-group-id="0183751064-13">Nx.Tensor</span><span class="p" data-group-id="0183751064-13">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0183751064-14">[</span><span class="mi">2</span><span class="p" data-group-id="0183751064-14">]</span><span class="p" data-group-id="0183751064-15">[</span><span class="mi">8</span><span class="p" data-group-id="0183751064-15">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-16">[</span><span class="w">
    </span><span class="p" data-group-id="0183751064-17">[</span><span class="mf">1.1407549381256104</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.22292715311050415</span><span class="p">,</span><span class="w"> </span><span class="mf">0.43234577775001526</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5845029354095459</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.8424829840660095</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9120126962661743</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.1202259063720703</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.9148870706558228</span><span class="p" data-group-id="0183751064-17">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0183751064-18">[</span><span class="mf">3.4583563804626465</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06578820943832397</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.776448130607605</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.563453197479248</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7628071308135986</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3.7287485599517822</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">12.002032279968262</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.19266414642334</span><span class="p" data-group-id="0183751064-18">]</span><span class="w">
  </span><span class="p" data-group-id="0183751064-16">]</span><span class="w">
</span><span class="p" data-group-id="0183751064-13">&gt;</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3733268741-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-3">#</span><span class="nc" data-group-id="3733268741-3">Nx.Tensor</span><span class="p" data-group-id="3733268741-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3733268741-4">[</span><span class="mi">8</span><span class="p" data-group-id="3733268741-4">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-5">[</span><span class="mf">0.6519372463226318</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4874255657196045</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6338149309158325</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-5">]</span><span class="w">
    </span><span class="p" data-group-id="3733268741-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-6">#</span><span class="nc" data-group-id="3733268741-6">Nx.Tensor</span><span class="p" data-group-id="3733268741-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3733268741-7">[</span><span class="mi">4</span><span class="p" data-group-id="3733268741-7">]</span><span class="p" data-group-id="3733268741-8">[</span><span class="mi">8</span><span class="p" data-group-id="3733268741-8">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-9">[</span><span class="w">
        </span><span class="p" data-group-id="3733268741-10">[</span><span class="mf">1.3038744926452637</span><span class="p">,</span><span class="w"> </span><span class="mf">1.949702262878418</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-10">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-11">[</span><span class="mf">1.9558117389678955</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4371278285980225</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6338149309158325</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-11">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-12">[</span><span class="mf">2.6077489852905273</span><span class="p">,</span><span class="w"> </span><span class="mf">2.924553394317627</span><span class="p">,</span><span class="w"> </span><span class="mf">1.267629861831665</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-12">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-13">[</span><span class="mf">3.259686231613159</span><span class="p">,</span><span class="w"> </span><span class="mf">3.4119789600372314</span><span class="p">,</span><span class="w"> </span><span class="mf">1.9014447927474976</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-13">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-9">]</span><span class="w">
    </span><span class="p" data-group-id="3733268741-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="3733268741-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-14">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-15">#</span><span class="nc" data-group-id="3733268741-15">Nx.Tensor</span><span class="p" data-group-id="3733268741-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3733268741-16">[</span><span class="mi">1</span><span class="p" data-group-id="3733268741-16">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-17">[</span><span class="mf">2.0</span><span class="p" data-group-id="3733268741-17">]</span><span class="w">
    </span><span class="p" data-group-id="3733268741-15">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3733268741-18">#</span><span class="nc" data-group-id="3733268741-18">Nx.Tensor</span><span class="p" data-group-id="3733268741-18">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="3733268741-19">[</span><span class="mi">8</span><span class="p" data-group-id="3733268741-19">]</span><span class="p" data-group-id="3733268741-20">[</span><span class="mi">1</span><span class="p" data-group-id="3733268741-20">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-21">[</span><span class="w">
        </span><span class="p" data-group-id="3733268741-22">[</span><span class="mf">4.599111557006836</span><span class="p" data-group-id="3733268741-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-23">[</span><span class="mf">0.06578820943832397</span><span class="p" data-group-id="3733268741-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-24">[</span><span class="mf">0.43234577775001526</span><span class="p" data-group-id="3733268741-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-25">[</span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-26">[</span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-26">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-27">[</span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-27">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-28">[</span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-28">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="3733268741-29">[</span><span class="mf">0.0</span><span class="p" data-group-id="3733268741-29">]</span><span class="w">
      </span><span class="p" data-group-id="3733268741-21">]</span><span class="w">
    </span><span class="p" data-group-id="3733268741-18">&gt;</span><span class="w">
  </span><span class="p" data-group-id="3733268741-14">}</span><span class="w">
</span><span class="p" data-group-id="3733268741-1">}</span></code></pre><p>Finally, you can specify hooks to only run when the model is built in a certain mode such as training and inference mode. You can read more about training and inference mode in <a href="training_and_inference_mode.html">Training and inference mode</a>:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="0587702937-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="0587702937-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="0587702937-2">(</span><span class="mi">8</span><span class="p" data-group-id="0587702937-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">attach_hook</span><span class="p" data-group-id="0587702937-3">(</span><span class="o">&amp;</span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:forward</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p">:</span><span class="w"> </span><span class="ss">:train</span><span class="p" data-group-id="0587702937-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="0587702937-4">(</span><span class="p" data-group-id="0587702937-4">)</span><span class="w">

</span><span class="p" data-group-id="0587702937-5">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="0587702937-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="0587702937-6">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p">:</span><span class="w"> </span><span class="ss">:train</span><span class="p" data-group-id="0587702937-6">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="0587702937-7">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0587702937-8">%{</span><span class="p" data-group-id="0587702937-8">}</span><span class="p" data-group-id="0587702937-7">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6639711599-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6639711599-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6639711599-3">#</span><span class="nc" data-group-id="6639711599-3">Nx.Tensor</span><span class="p" data-group-id="6639711599-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6639711599-4">[</span><span class="mi">8</span><span class="p" data-group-id="6639711599-4">]</span><span class="w">
      </span><span class="p" data-group-id="6639711599-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="6639711599-5">]</span><span class="w">
    </span><span class="p" data-group-id="6639711599-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6639711599-6">#</span><span class="nc" data-group-id="6639711599-6">Nx.Tensor</span><span class="p" data-group-id="6639711599-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6639711599-7">[</span><span class="mi">4</span><span class="p" data-group-id="6639711599-7">]</span><span class="p" data-group-id="6639711599-8">[</span><span class="mi">8</span><span class="p" data-group-id="6639711599-8">]</span><span class="w">
      </span><span class="p" data-group-id="6639711599-9">[</span><span class="w">
        </span><span class="p" data-group-id="6639711599-10">[</span><span class="o">-</span><span class="mf">0.13241732120513916</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6946331858634949</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6328000426292419</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.684409499168396</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.39569517970085144</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.10005003213882446</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2501150965690613</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14561182260513306</span><span class="p" data-group-id="6639711599-10">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6639711599-11">[</span><span class="o">-</span><span class="mf">0.5495109558105469</span><span class="p">,</span><span class="w"> </span><span class="mf">0.459137499332428</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4059434235095978</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4489462077617645</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6331832408905029</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05011630058288574</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.35836488008499146</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2661571800708771</span><span class="p" data-group-id="6639711599-11">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6639711599-12">[</span><span class="mf">0.29260867834091187</span><span class="p">,</span><span class="w"> </span><span class="mf">0.42186349630355835</span><span class="p">,</span><span class="w"> </span><span class="mf">0.32596689462661743</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.12340176105499268</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6767188906669617</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2658537030220032</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5745270848274231</span><span class="p">,</span><span class="w"> </span><span class="mf">6.475448608398438e-4</span><span class="p" data-group-id="6639711599-12">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6639711599-13">[</span><span class="mf">0.16781508922576904</span><span class="p">,</span><span class="w"> </span><span class="mf">0.23747843503952026</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5311254858970642</span><span class="p">,</span><span class="w"> </span><span class="mf">0.22617805004119873</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5153165459632874</span><span class="p">,</span><span class="w"> </span><span class="mf">0.19729173183441162</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5706893801689148</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5531126260757446</span><span class="p" data-group-id="6639711599-13">]</span><span class="w">
      </span><span class="p" data-group-id="6639711599-9">]</span><span class="w">
    </span><span class="p" data-group-id="6639711599-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6639711599-2">}</span><span class="w">
</span><span class="p" data-group-id="6639711599-1">}</span></code></pre><p>The model was built in training mode so the hook will run:</p><pre><code class="makeup elixir" translate="no"><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="3632356551-1">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="3632356551-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="1934424359-1">#</span><span class="nc" data-group-id="1934424359-1">Nx.Tensor</span><span class="p" data-group-id="1934424359-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="1934424359-2">[</span><span class="mi">2</span><span class="p" data-group-id="1934424359-2">]</span><span class="p" data-group-id="1934424359-3">[</span><span class="mi">8</span><span class="p" data-group-id="1934424359-3">]</span><span class="w">
  </span><span class="p" data-group-id="1934424359-4">[</span><span class="w">
    </span><span class="p" data-group-id="1934424359-5">[</span><span class="mf">0.539151668548584</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0152997970581055</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.347386121749878</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.017215579748153687</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.8256950974464417</span><span class="p">,</span><span class="w"> </span><span class="mf">1.173698902130127</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9213788509368896</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.9241999387741089</span><span class="p" data-group-id="1934424359-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1934424359-6">[</span><span class="o">-</span><span class="mf">0.3468663692474365</span><span class="p">,</span><span class="w"> </span><span class="mf">9.267749786376953</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">6.322994232177734</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.139533042907715</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.295599460601807</span><span class="p">,</span><span class="w"> </span><span class="mf">2.8265457153320312</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.3390271663665771</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4.616241931915283</span><span class="p" data-group-id="1934424359-6">]</span><span class="w">
  </span><span class="p" data-group-id="1934424359-4">]</span><span class="w">
</span><span class="p" data-group-id="1934424359-1">&gt;</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="5247254280-1">%{</span><span class="w">
  </span><span class="ss">prediction</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5247254280-2">#</span><span class="nc" data-group-id="5247254280-2">Nx.Tensor</span><span class="p" data-group-id="5247254280-2">&lt;</span><span class="w">
    </span><span class="n">f32</span><span class="p" data-group-id="5247254280-3">[</span><span class="mi">2</span><span class="p" data-group-id="5247254280-3">]</span><span class="p" data-group-id="5247254280-4">[</span><span class="mi">8</span><span class="p" data-group-id="5247254280-4">]</span><span class="w">
    </span><span class="p" data-group-id="5247254280-5">[</span><span class="w">
      </span><span class="p" data-group-id="5247254280-6">[</span><span class="mf">0.539151668548584</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0152997970581055</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.173698902130127</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="5247254280-6">]</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="5247254280-7">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">9.267749786376953</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.8265457153320312</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="5247254280-7">]</span><span class="w">
    </span><span class="p" data-group-id="5247254280-5">]</span><span class="w">
  </span><span class="p" data-group-id="5247254280-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">state</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5247254280-8">%{</span><span class="p" data-group-id="5247254280-8">}</span><span class="w">
</span><span class="p" data-group-id="5247254280-1">}</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="8009420554-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="8009420554-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="8009420554-2">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p">:</span><span class="w"> </span><span class="ss">:inference</span><span class="p" data-group-id="8009420554-2">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="8009420554-3">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8009420554-4">%{</span><span class="p" data-group-id="8009420554-4">}</span><span class="p" data-group-id="8009420554-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7178625230-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178625230-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178625230-3">#</span><span class="nc" data-group-id="7178625230-3">Nx.Tensor</span><span class="p" data-group-id="7178625230-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7178625230-4">[</span><span class="mi">8</span><span class="p" data-group-id="7178625230-4">]</span><span class="w">
      </span><span class="p" data-group-id="7178625230-5">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="7178625230-5">]</span><span class="w">
    </span><span class="p" data-group-id="7178625230-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178625230-6">#</span><span class="nc" data-group-id="7178625230-6">Nx.Tensor</span><span class="p" data-group-id="7178625230-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7178625230-7">[</span><span class="mi">4</span><span class="p" data-group-id="7178625230-7">]</span><span class="p" data-group-id="7178625230-8">[</span><span class="mi">8</span><span class="p" data-group-id="7178625230-8">]</span><span class="w">
      </span><span class="p" data-group-id="7178625230-9">[</span><span class="w">
        </span><span class="p" data-group-id="7178625230-10">[</span><span class="mf">0.02683490514755249</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.28041765093803406</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15839070081710815</span><span class="p">,</span><span class="w"> </span><span class="mf">0.16674137115478516</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5444575548171997</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.34951671957969666</span><span class="p">,</span><span class="w"> </span><span class="mf">0.08247309923171997</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6700448393821716</span><span class="p" data-group-id="7178625230-10">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7178625230-11">[</span><span class="mf">0.6001952290534973</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.26907777786254883</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4580194354057312</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.060002803802490234</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5385662317276001</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.46773862838745117</span><span class="p">,</span><span class="w"> </span><span class="mf">0.25804388523101807</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6824946999549866</span><span class="p" data-group-id="7178625230-11">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7178625230-12">[</span><span class="mf">0.13328874111175537</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.46421635150909424</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5192649960517883</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0429919958114624</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0771912932395935</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.447194904088974</span><span class="p">,</span><span class="w"> </span><span class="mf">0.30910569429397583</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6105270981788635</span><span class="p" data-group-id="7178625230-12">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7178625230-13">[</span><span class="mf">0.5253992676734924</span><span class="p">,</span><span class="w"> </span><span class="mf">0.41786473989486694</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6903378367424011</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6038702130317688</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06673228740692139</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4242702126502991</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6737087368965149</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6956207156181335</span><span class="p" data-group-id="7178625230-13">]</span><span class="w">
      </span><span class="p" data-group-id="7178625230-9">]</span><span class="w">
    </span><span class="p" data-group-id="7178625230-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="7178625230-2">}</span><span class="w">
</span><span class="p" data-group-id="7178625230-1">}</span></code></pre><p>The model was built in inference mode so the hook will not run:</p><pre><code class="makeup elixir" translate="no"><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="8502983804-1">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="8502983804-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="2558652840-1">#</span><span class="nc" data-group-id="2558652840-1">Nx.Tensor</span><span class="p" data-group-id="2558652840-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="2558652840-2">[</span><span class="mi">2</span><span class="p" data-group-id="2558652840-2">]</span><span class="p" data-group-id="2558652840-3">[</span><span class="mi">8</span><span class="p" data-group-id="2558652840-3">]</span><span class="w">
  </span><span class="p" data-group-id="2558652840-4">[</span><span class="w">
    </span><span class="p" data-group-id="2558652840-5">[</span><span class="mf">2.4429705142974854</span><span class="p">,</span><span class="w"> </span><span class="mf">0.056083738803863525</span><span class="p">,</span><span class="w"> </span><span class="mf">1.490502953529358</span><span class="p">,</span><span class="w"> </span><span class="mf">1.6656239032745361</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="2558652840-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2558652840-6">[</span><span class="mf">7.585843086242676</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.640434741973877</span><span class="p">,</span><span class="w"> </span><span class="mf">4.336091041564941</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="2558652840-6">]</span><span class="w">
  </span><span class="p" data-group-id="2558652840-4">]</span><span class="w">
</span><span class="p" data-group-id="2558652840-1">&gt;</span></code></pre>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="custom_layers.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Custom layers
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="accelerating_axon.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Accelerating Axon
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.6.1" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/axon/0.6.1">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/axon/0.6.1/show/guides/model_creation/model_hooks.livemd">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Axon.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
