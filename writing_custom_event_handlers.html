<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.6">
    <meta name="project" content="Axon v0.3.0">

    <title>Writing custom event handlers — Axon v0.3.0</title>
    <link rel="stylesheet" href="dist/html-elixir-5CLCQQME.css" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-X7YVL3G2.js"></script>
    <script src="dist/sidebar_items-CEB5417F.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-PLW5RNNI.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.3.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.3.0/guides/training_and_evaluation/writing_custom_event_handlers.livemd#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>Writing custom event handlers</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="4621618946-1">(</span><span class="p" data-group-id="4621618946-2">[</span><span class="w">
  </span><span class="p" data-group-id="4621618946-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/axon&quot;</span><span class="p" data-group-id="4621618946-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="4621618946-4">{</span><span class="ss">:nx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.3.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">sparse</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">override</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="4621618946-4">}</span><span class="w">
</span><span class="p" data-group-id="4621618946-2">]</span><span class="p" data-group-id="4621618946-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="writing-custom-event-handlers" class="section-heading">
  <a href="#writing-custom-event-handlers" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">writing-custom-event-handlers</p>
  </a>
  Writing custom event handlers
</h2>
<p>If you require functionality not offered by any of Axon's built-in event handlers, then you'll need to write a custom event handler. Custom event handlers are functions which accept loop state, perform some action, and then defer execution back to the main loop. For example, you can write custom loop handlers which visualize model outputs, communicate with an external Kino process, or simply halt the loop based on some criteria.</p><p>All event handlers must accept an <code class="inline">%Axon.Loop.State{}</code> struct and return a tuple of <code class="inline">{control_term, state}</code> where <code class="inline">control_term</code> is one of <code class="inline">:continue</code>, <code class="inline">:halt_epoch</code>, or <code class="inline">:halt_loop</code> and <code class="inline">state</code> is the updated loop state:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="w"> </span><span class="k" data-group-id="1154563249-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">my_weird_handler</span><span class="p" data-group-id="1154563249-2">(</span><span class="p" data-group-id="1154563249-3">%</span><span class="nc" data-group-id="1154563249-3">State</span><span class="p" data-group-id="1154563249-3">{</span><span class="p" data-group-id="1154563249-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1154563249-2">)</span><span class="w"> </span><span class="k" data-group-id="1154563249-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1154563249-5">(</span><span class="s">&quot;My weird handler: fired&quot;</span><span class="p" data-group-id="1154563249-5">)</span><span class="w">
    </span><span class="p" data-group-id="1154563249-6">{</span><span class="ss">:continue</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1154563249-6">}</span><span class="w">
  </span><span class="k" data-group-id="1154563249-4">end</span><span class="w">
</span><span class="k" data-group-id="1154563249-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0549248665-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0549248665-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="0549248665-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0549248665-3">{</span><span class="ss">:my_weird_handler</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0549248665-3">}</span><span class="p" data-group-id="0549248665-1">}</span></code></pre><p>To register event handlers, you use <a href="Axon.Loop.html#handle/4"><code class="inline">Axon.Loop.handle/4</code></a>:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="6909325948-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="6909325948-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="6909325948-2">(</span><span class="mi">8</span><span class="p" data-group-id="6909325948-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="6909325948-3">(</span><span class="p" data-group-id="6909325948-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="6909325948-4">(</span><span class="mi">4</span><span class="p" data-group-id="6909325948-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="6909325948-5">(</span><span class="p" data-group-id="6909325948-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="6909325948-6">(</span><span class="mi">1</span><span class="p" data-group-id="6909325948-6">)</span><span class="w">

</span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="6909325948-7">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="6909325948-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle</span><span class="p" data-group-id="6909325948-8">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler</span><span class="o">.</span><span class="n">my_weird_handler</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6909325948-8">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7129538736-1">#</span><span class="nc" data-group-id="7129538736-1">Axon.Loop</span><span class="p" data-group-id="7129538736-1">&lt;</span><span class="w">
  </span><span class="ss">handlers</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-2">%{</span><span class="w">
    </span><span class="ss">completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-3">[</span><span class="p" data-group-id="7129538736-3">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-4">[</span><span class="w">
      </span><span class="p" data-group-id="7129538736-5">{</span><span class="o">&amp;</span><span class="nc">CustomEventHandler</span><span class="o">.</span><span class="n">my_weird_handler</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="7129538736-6">#</span><span class="nc" data-group-id="7129538736-6">Function</span><span class="p" data-group-id="7129538736-6">&lt;</span><span class="mf">5.33119226</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7129538736-6">&gt;</span><span class="p" data-group-id="7129538736-5">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="7129538736-7">{</span><span class="p" data-group-id="7129538736-8">#</span><span class="nc" data-group-id="7129538736-8">Function</span><span class="p" data-group-id="7129538736-8">&lt;</span><span class="mf">23.33119226</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">5</span><span class="p" data-group-id="7129538736-8">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="7129538736-9">#</span><span class="nc" data-group-id="7129538736-9">Function</span><span class="p" data-group-id="7129538736-9">&lt;</span><span class="mf">5.33119226</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7129538736-9">&gt;</span><span class="p" data-group-id="7129538736-7">}</span><span class="w">
    </span><span class="p" data-group-id="7129538736-4">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-10">[</span><span class="p" data-group-id="7129538736-10">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-11">[</span><span class="p" data-group-id="7129538736-11">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-12">[</span><span class="p" data-group-id="7129538736-12">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-13">[</span><span class="w">
      </span><span class="p" data-group-id="7129538736-14">{</span><span class="p" data-group-id="7129538736-15">#</span><span class="nc" data-group-id="7129538736-15">Function</span><span class="p" data-group-id="7129538736-15">&lt;</span><span class="mf">23.33119226</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">5</span><span class="p" data-group-id="7129538736-15">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="7129538736-16">#</span><span class="nc" data-group-id="7129538736-16">Function</span><span class="p" data-group-id="7129538736-16">&lt;</span><span class="mf">3.33119226</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7129538736-16">&gt;</span><span class="p" data-group-id="7129538736-14">}</span><span class="w">
    </span><span class="p" data-group-id="7129538736-13">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-17">[</span><span class="p" data-group-id="7129538736-17">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-18">[</span><span class="p" data-group-id="7129538736-18">]</span><span class="w">
  </span><span class="p" data-group-id="7129538736-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">metrics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7129538736-19">%{</span><span class="w">
    </span><span class="s">&quot;loss&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7129538736-20">{</span><span class="p" data-group-id="7129538736-21">#</span><span class="nc" data-group-id="7129538736-21">Function</span><span class="p" data-group-id="7129538736-21">&lt;</span><span class="mf">12.46375131</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Metrics</span><span class="o">.</span><span class="n">running_average</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7129538736-21">&gt;</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="7129538736-22">#</span><span class="nc" data-group-id="7129538736-22">Function</span><span class="p" data-group-id="7129538736-22">&lt;</span><span class="mf">6.33119226</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_loss_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7129538736-22">&gt;</span><span class="p" data-group-id="7129538736-20">}</span><span class="w">
  </span><span class="p" data-group-id="7129538736-19">}</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="7129538736-1">&gt;</span></code></pre><p>Axon will trigger your custom handler to run on the attached event:</p><pre><code class="makeup elixir" translate="no"><span class="n">train_data</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Stream</span><span class="o">.</span><span class="n">repeatedly</span><span class="p" data-group-id="6562033677-1">(</span><span class="k" data-group-id="6562033677-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">random_normal</span><span class="p" data-group-id="6562033677-3">(</span><span class="p" data-group-id="6562033677-4">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6562033677-4">}</span><span class="p" data-group-id="6562033677-3">)</span><span class="w">
    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">sin</span><span class="p" data-group-id="6562033677-5">(</span><span class="n">xs</span><span class="p" data-group-id="6562033677-5">)</span><span class="w">
    </span><span class="p" data-group-id="6562033677-6">{</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p" data-group-id="6562033677-6">}</span><span class="w">
  </span><span class="k" data-group-id="6562033677-2">end</span><span class="p" data-group-id="6562033677-1">)</span><span class="w">

</span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6562033677-7">(</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6562033677-8">%{</span><span class="p" data-group-id="6562033677-8">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="6562033677-7">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1905403</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1478554</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1184390</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0983292</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0845697</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="2824362439-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-3">#</span><span class="nc" data-group-id="2824362439-3">Nx.Tensor</span><span class="p" data-group-id="2824362439-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-4">[</span><span class="mi">8</span><span class="p" data-group-id="2824362439-4">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-5">[</span><span class="mf">0.014659373089671135</span><span class="p">,</span><span class="w"> </span><span class="mf">0.08941870182752609</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.09661660343408585</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2650177478790283</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.06400775164365768</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07953602075576782</span><span class="p">,</span><span class="w"> </span><span class="mf">0.22094617784023285</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.014790073968470097</span><span class="p" data-group-id="2824362439-5">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-6">#</span><span class="nc" data-group-id="2824362439-6">Nx.Tensor</span><span class="p" data-group-id="2824362439-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-7">[</span><span class="mi">1</span><span class="p" data-group-id="2824362439-7">]</span><span class="p" data-group-id="2824362439-8">[</span><span class="mi">8</span><span class="p" data-group-id="2824362439-8">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-9">[</span><span class="w">
        </span><span class="p" data-group-id="2824362439-10">[</span><span class="mf">0.3581556975841522</span><span class="p">,</span><span class="w"> </span><span class="mf">0.38828182220458984</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3311854302883148</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4059808552265167</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6334917545318604</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17008493840694427</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5630434155464172</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3790667653083801</span><span class="p" data-group-id="2824362439-10">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-9">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="2824362439-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-12">#</span><span class="nc" data-group-id="2824362439-12">Nx.Tensor</span><span class="p" data-group-id="2824362439-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-13">[</span><span class="mi">4</span><span class="p" data-group-id="2824362439-13">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-14">[</span><span class="mf">0.3047839403152466</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.025677276775240898</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18113580346107483</span><span class="p">,</span><span class="w"> </span><span class="mf">0.19019420444965363</span><span class="p" data-group-id="2824362439-14">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-15">#</span><span class="nc" data-group-id="2824362439-15">Nx.Tensor</span><span class="p" data-group-id="2824362439-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-16">[</span><span class="mi">8</span><span class="p" data-group-id="2824362439-16">]</span><span class="p" data-group-id="2824362439-17">[</span><span class="mi">4</span><span class="p" data-group-id="2824362439-17">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-18">[</span><span class="w">
        </span><span class="p" data-group-id="2824362439-19">[</span><span class="o">-</span><span class="mf">0.25477269291877747</span><span class="p">,</span><span class="w"> </span><span class="mf">0.28833284974098206</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.25498083233833313</span><span class="p">,</span><span class="w"> </span><span class="mf">0.40912926197052</span><span class="p" data-group-id="2824362439-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-20">[</span><span class="o">-</span><span class="mf">0.387851357460022</span><span class="p">,</span><span class="w"> </span><span class="mf">0.009837300516664982</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.48930269479751587</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6119663715362549</span><span class="p" data-group-id="2824362439-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-21">[</span><span class="mf">0.49769237637519836</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.45746952295303345</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3886529505252838</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.49895355105400085</span><span class="p" data-group-id="2824362439-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-22">[</span><span class="mf">0.6451961994171143</span><span class="p">,</span><span class="w"> </span><span class="mf">0.16054697334766388</span><span class="p">,</span><span class="w"> </span><span class="mf">0.27802371978759766</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.15226426720619202</span><span class="p" data-group-id="2824362439-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-23">[</span><span class="mf">0.17125651240348816</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.048851024359464645</span><span class="p">,</span><span class="w"> </span><span class="mf">0.19429178535938263</span><span class="p">,</span><span class="w"> </span><span class="mf">0.24933232367038727</span><span class="p" data-group-id="2824362439-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-24">[</span><span class="mf">0.5465306043624878</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.15836869180202484</span><span class="p">,</span><span class="w"> </span><span class="mf">0.39782997965812683</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3635501563549042</span><span class="p" data-group-id="2824362439-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-25">[</span><span class="o">-</span><span class="mf">0.36660289764404297</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.011948992498219013</span><span class="p">,</span><span class="w"> </span><span class="mf">0.48680511116981506</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5263928174972534</span><span class="p" data-group-id="2824362439-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-26">[</span><span class="o">-</span><span class="mf">0.6284276843070984</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5880372524261475</span><span class="p">,</span><span class="w"> </span><span class="mf">0.004470183979719877</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4550755023956299</span><span class="p" data-group-id="2824362439-26">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-18">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="2824362439-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-28">#</span><span class="nc" data-group-id="2824362439-28">Nx.Tensor</span><span class="p" data-group-id="2824362439-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-29">[</span><span class="mi">1</span><span class="p" data-group-id="2824362439-29">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-30">[</span><span class="mf">0.7117368578910828</span><span class="p" data-group-id="2824362439-30">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2824362439-31">#</span><span class="nc" data-group-id="2824362439-31">Nx.Tensor</span><span class="p" data-group-id="2824362439-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="2824362439-32">[</span><span class="mi">4</span><span class="p" data-group-id="2824362439-32">]</span><span class="p" data-group-id="2824362439-33">[</span><span class="mi">1</span><span class="p" data-group-id="2824362439-33">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-34">[</span><span class="w">
        </span><span class="p" data-group-id="2824362439-35">[</span><span class="o">-</span><span class="mf">0.7743457555770874</span><span class="p" data-group-id="2824362439-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-36">[</span><span class="mf">0.3977936804294586</span><span class="p" data-group-id="2824362439-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-37">[</span><span class="o">-</span><span class="mf">1.0638943910598755</span><span class="p" data-group-id="2824362439-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2824362439-38">[</span><span class="o">-</span><span class="mf">0.6494196653366089</span><span class="p" data-group-id="2824362439-38">]</span><span class="w">
      </span><span class="p" data-group-id="2824362439-34">]</span><span class="w">
    </span><span class="p" data-group-id="2824362439-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="2824362439-27">}</span><span class="w">
</span><span class="p" data-group-id="2824362439-1">}</span></code></pre><p>You can use event handlers to early-stop a loop or loop epoch by returning a <code class="inline">:halt_*</code> control term. Halt control terms can be one of <code class="inline">:halt_epoch</code> or <code class="inline">:halt_loop</code>. <code class="inline">:halt_epoch</code> halts the current epoch and continues to the next. <code class="inline">:halt_loop</code> halts the loop altogether.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="w"> </span><span class="k" data-group-id="3523012350-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts</span><span class="p" data-group-id="3523012350-2">(</span><span class="p" data-group-id="3523012350-3">%</span><span class="nc" data-group-id="3523012350-3">State</span><span class="p" data-group-id="3523012350-3">{</span><span class="p" data-group-id="3523012350-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="3523012350-2">)</span><span class="w"> </span><span class="k" data-group-id="3523012350-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="3523012350-5">(</span><span class="s">&quot;stopping loop&quot;</span><span class="p" data-group-id="3523012350-5">)</span><span class="w">
    </span><span class="p" data-group-id="3523012350-6">{</span><span class="ss">:halt_loop</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="3523012350-6">}</span><span class="w">
  </span><span class="k" data-group-id="3523012350-4">end</span><span class="w">
</span><span class="k" data-group-id="3523012350-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0651927892-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0651927892-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="0651927892-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0651927892-3">{</span><span class="ss">:always_halts</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0651927892-3">}</span><span class="p" data-group-id="0651927892-1">}</span></code></pre><p>The loop will immediately stop executing and return the current state at the time it was halted:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="2886441954-1">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="2886441954-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle</span><span class="p" data-group-id="2886441954-2">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler</span><span class="o">.</span><span class="n">always_halts</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2886441954-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2886441954-3">(</span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2886441954-4">%{</span><span class="p" data-group-id="2886441954-4">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="2886441954-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1967763</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">loop</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9572716610-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-3">#</span><span class="nc" data-group-id="9572716610-3">Nx.Tensor</span><span class="p" data-group-id="9572716610-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-4">[</span><span class="mi">8</span><span class="p" data-group-id="9572716610-4">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-5">[</span><span class="o">-</span><span class="mf">0.05958094820380211</span><span class="p">,</span><span class="w"> </span><span class="mf">0.08930676430463791</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.006259916350245476</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05067025125026703</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10981185734272003</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.011248357594013214</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.007601946126669645</span><span class="p">,</span><span class="w"> </span><span class="mf">0.036958880722522736</span><span class="p" data-group-id="9572716610-5">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-6">#</span><span class="nc" data-group-id="9572716610-6">Nx.Tensor</span><span class="p" data-group-id="9572716610-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-7">[</span><span class="mi">1</span><span class="p" data-group-id="9572716610-7">]</span><span class="p" data-group-id="9572716610-8">[</span><span class="mi">8</span><span class="p" data-group-id="9572716610-8">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-9">[</span><span class="w">
        </span><span class="p" data-group-id="9572716610-10">[</span><span class="mf">0.050393108278512955</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5486620664596558</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6901980042457581</span><span class="p">,</span><span class="w"> </span><span class="mf">0.42280837893486023</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6446300745010376</span><span class="p">,</span><span class="w"> </span><span class="mf">0.25207778811454773</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.13566234707832336</span><span class="p">,</span><span class="w"> </span><span class="mf">0.26625606417655945</span><span class="p" data-group-id="9572716610-10">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-9">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9572716610-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-12">#</span><span class="nc" data-group-id="9572716610-12">Nx.Tensor</span><span class="p" data-group-id="9572716610-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-13">[</span><span class="mi">4</span><span class="p" data-group-id="9572716610-13">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-14">[</span><span class="o">-</span><span class="mf">0.06729397922754288</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14259757101535797</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0020351663697510958</span><span class="p">,</span><span class="w"> </span><span class="mf">0.16679106652736664</span><span class="p" data-group-id="9572716610-14">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-15">#</span><span class="nc" data-group-id="9572716610-15">Nx.Tensor</span><span class="p" data-group-id="9572716610-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-16">[</span><span class="mi">8</span><span class="p" data-group-id="9572716610-16">]</span><span class="p" data-group-id="9572716610-17">[</span><span class="mi">4</span><span class="p" data-group-id="9572716610-17">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-18">[</span><span class="w">
        </span><span class="p" data-group-id="9572716610-19">[</span><span class="o">-</span><span class="mf">0.5964004397392273</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5631846785545349</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15613533556461334</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1943722516298294</span><span class="p" data-group-id="9572716610-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-20">[</span><span class="mf">0.19513694941997528</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.24765732884407043</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.06751974672079086</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6707308292388916</span><span class="p" data-group-id="9572716610-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-21">[</span><span class="o">-</span><span class="mf">0.6826592087745667</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.006577506195753813</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6097249984741211</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5801466703414917</span><span class="p" data-group-id="9572716610-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-22">[</span><span class="o">-</span><span class="mf">0.30076032876968384</span><span class="p">,</span><span class="w"> </span><span class="mf">0.34819719195365906</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5906499028205872</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.37741175293922424</span><span class="p" data-group-id="9572716610-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-23">[</span><span class="mf">0.16266342997550964</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7666646838188171</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6456886529922485</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4589986801147461</span><span class="p" data-group-id="9572716610-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-24">[</span><span class="o">-</span><span class="mf">0.2686948776245117</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.06113003194332123</span><span class="p">,</span><span class="w"> </span><span class="mf">0.22663049399852753</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.12092678993940353</span><span class="p" data-group-id="9572716610-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-25">[</span><span class="o">-</span><span class="mf">0.5785921216011047</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.641874372959137</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.24317769706249237</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2897084951400757</span><span class="p" data-group-id="9572716610-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-26">[</span><span class="mf">0.14917287230491638</span><span class="p">,</span><span class="w"> </span><span class="mf">0.24462535977363586</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.64858478307724</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5138146877288818</span><span class="p" data-group-id="9572716610-26">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-18">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9572716610-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-28">#</span><span class="nc" data-group-id="9572716610-28">Nx.Tensor</span><span class="p" data-group-id="9572716610-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-29">[</span><span class="mi">1</span><span class="p" data-group-id="9572716610-29">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-30">[</span><span class="o">-</span><span class="mf">0.11649220436811447</span><span class="p" data-group-id="9572716610-30">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9572716610-31">#</span><span class="nc" data-group-id="9572716610-31">Nx.Tensor</span><span class="p" data-group-id="9572716610-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9572716610-32">[</span><span class="mi">4</span><span class="p" data-group-id="9572716610-32">]</span><span class="p" data-group-id="9572716610-33">[</span><span class="mi">1</span><span class="p" data-group-id="9572716610-33">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-34">[</span><span class="w">
        </span><span class="p" data-group-id="9572716610-35">[</span><span class="mf">0.7849427461624146</span><span class="p" data-group-id="9572716610-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-36">[</span><span class="mf">0.5966104865074158</span><span class="p" data-group-id="9572716610-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-37">[</span><span class="o">-</span><span class="mf">0.5520159602165222</span><span class="p" data-group-id="9572716610-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9572716610-38">[</span><span class="o">-</span><span class="mf">0.4974740147590637</span><span class="p" data-group-id="9572716610-38">]</span><span class="w">
      </span><span class="p" data-group-id="9572716610-34">]</span><span class="w">
    </span><span class="p" data-group-id="9572716610-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9572716610-27">}</span><span class="w">
</span><span class="p" data-group-id="9572716610-1">}</span></code></pre><p>Note that halting an epoch will fire a different event than completing an epoch. So if you implement a custom handler to halt the loop when an epoch completes, it will never fire if the epoch always halts prematurely:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="w"> </span><span class="k" data-group-id="7040825110-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts_epoch</span><span class="p" data-group-id="7040825110-2">(</span><span class="p" data-group-id="7040825110-3">%</span><span class="nc" data-group-id="7040825110-3">State</span><span class="p" data-group-id="7040825110-3">{</span><span class="p" data-group-id="7040825110-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="7040825110-2">)</span><span class="w"> </span><span class="k" data-group-id="7040825110-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="7040825110-5">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">stopping epoch&quot;</span><span class="p" data-group-id="7040825110-5">)</span><span class="w">
    </span><span class="p" data-group-id="7040825110-6">{</span><span class="ss">:halt_epoch</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="7040825110-6">}</span><span class="w">
  </span><span class="k" data-group-id="7040825110-4">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts_loop</span><span class="p" data-group-id="7040825110-7">(</span><span class="p" data-group-id="7040825110-8">%</span><span class="nc" data-group-id="7040825110-8">State</span><span class="p" data-group-id="7040825110-8">{</span><span class="p" data-group-id="7040825110-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="7040825110-7">)</span><span class="w"> </span><span class="k" data-group-id="7040825110-9">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="7040825110-10">(</span><span class="s">&quot;stopping loop</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="7040825110-10">)</span><span class="w">
    </span><span class="p" data-group-id="7040825110-11">{</span><span class="ss">:halt_loop</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="7040825110-11">}</span><span class="w">
  </span><span class="k" data-group-id="7040825110-9">end</span><span class="w">
</span><span class="k" data-group-id="7040825110-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8300450458-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8300450458-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="8300450458-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8300450458-3">{</span><span class="ss">:always_halts_loop</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8300450458-3">}</span><span class="p" data-group-id="8300450458-1">}</span></code></pre><p>If you run these handlers in conjunction, the loop will not terminate prematurely:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="2343434514-1">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="2343434514-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle</span><span class="p" data-group-id="2343434514-2">(</span><span class="ss">:iteration_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler</span><span class="o">.</span><span class="n">always_halts_epoch</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2343434514-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle</span><span class="p" data-group-id="2343434514-3">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler</span><span class="o">.</span><span class="n">always_halts_loop</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2343434514-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2343434514-4">(</span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2343434514-5">%{</span><span class="p" data-group-id="2343434514-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="2343434514-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0000000</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7256396</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4574284</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4981923</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4377063</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6060843112-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-3">#</span><span class="nc" data-group-id="6060843112-3">Nx.Tensor</span><span class="p" data-group-id="6060843112-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-4">[</span><span class="mi">8</span><span class="p" data-group-id="6060843112-4">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-5">[</span><span class="mf">9.248655405826867e-4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0038722341414541006</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0015197680331766605</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.001993122510612011</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0015419051051139832</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.004070846363902092</span><span class="p">,</span><span class="w"> </span><span class="mf">0.001461982261389494</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0043989671394228935</span><span class="p" data-group-id="6060843112-5">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-6">#</span><span class="nc" data-group-id="6060843112-6">Nx.Tensor</span><span class="p" data-group-id="6060843112-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-7">[</span><span class="mi">1</span><span class="p" data-group-id="6060843112-7">]</span><span class="p" data-group-id="6060843112-8">[</span><span class="mi">8</span><span class="p" data-group-id="6060843112-8">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-9">[</span><span class="w">
        </span><span class="p" data-group-id="6060843112-10">[</span><span class="o">-</span><span class="mf">0.6537156701087952</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2857331335544586</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.339731365442276</span><span class="p">,</span><span class="w"> </span><span class="mf">0.46841081976890564</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5864744782447815</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.364472359418869</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5385616421699524</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.694677472114563</span><span class="p" data-group-id="6060843112-10">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-9">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6060843112-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-12">#</span><span class="nc" data-group-id="6060843112-12">Nx.Tensor</span><span class="p" data-group-id="6060843112-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-13">[</span><span class="mi">4</span><span class="p" data-group-id="6060843112-13">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-14">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.017093738541007042</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00152371556032449</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0019599769730120897</span><span class="p" data-group-id="6060843112-14">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-15">#</span><span class="nc" data-group-id="6060843112-15">Nx.Tensor</span><span class="p" data-group-id="6060843112-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-16">[</span><span class="mi">8</span><span class="p" data-group-id="6060843112-16">]</span><span class="p" data-group-id="6060843112-17">[</span><span class="mi">4</span><span class="p" data-group-id="6060843112-17">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-18">[</span><span class="w">
        </span><span class="p" data-group-id="6060843112-19">[</span><span class="o">-</span><span class="mf">0.21336764097213745</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6211493611335754</span><span class="p">,</span><span class="w"> </span><span class="mf">0.676548957824707</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3768426477909088</span><span class="p" data-group-id="6060843112-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-20">[</span><span class="o">-</span><span class="mf">0.24921125173568726</span><span class="p">,</span><span class="w"> </span><span class="mf">0.217195525765419</span><span class="p">,</span><span class="w"> </span><span class="mf">0.23704318702220917</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1597728431224823</span><span class="p" data-group-id="6060843112-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-21">[</span><span class="o">-</span><span class="mf">0.12178827077150345</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4966273307800293</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.283501535654068</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00888047181069851</span><span class="p" data-group-id="6060843112-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-22">[</span><span class="o">-</span><span class="mf">0.19504092633724213</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18697738647460938</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14705461263656616</span><span class="p">,</span><span class="w"> </span><span class="mf">0.39286476373672485</span><span class="p" data-group-id="6060843112-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-23">[</span><span class="o">-</span><span class="mf">0.5945789813995361</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5958647727966309</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3320448100566864</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.02747068926692009</span><span class="p" data-group-id="6060843112-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-24">[</span><span class="o">-</span><span class="mf">0.2157520055770874</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2990635335445404</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.16008871793746948</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4921063184738159</span><span class="p" data-group-id="6060843112-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-25">[</span><span class="o">-</span><span class="mf">0.529068648815155</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.383655846118927</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07292155921459198</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2834954559803009</span><span class="p" data-group-id="6060843112-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-26">[</span><span class="o">-</span><span class="mf">0.3056498169898987</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.28507867455482483</span><span class="p">,</span><span class="w"> </span><span class="mf">0.554026186466217</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.24665579199790955</span><span class="p" data-group-id="6060843112-26">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-18">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6060843112-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-28">#</span><span class="nc" data-group-id="6060843112-28">Nx.Tensor</span><span class="p" data-group-id="6060843112-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-29">[</span><span class="mi">1</span><span class="p" data-group-id="6060843112-29">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-30">[</span><span class="o">-</span><span class="mf">0.010511377826333046</span><span class="p" data-group-id="6060843112-30">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6060843112-31">#</span><span class="nc" data-group-id="6060843112-31">Nx.Tensor</span><span class="p" data-group-id="6060843112-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6060843112-32">[</span><span class="mi">4</span><span class="p" data-group-id="6060843112-32">]</span><span class="p" data-group-id="6060843112-33">[</span><span class="mi">1</span><span class="p" data-group-id="6060843112-33">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-34">[</span><span class="w">
        </span><span class="p" data-group-id="6060843112-35">[</span><span class="mf">0.9865502119064331</span><span class="p" data-group-id="6060843112-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-36">[</span><span class="o">-</span><span class="mf">0.686279296875</span><span class="p" data-group-id="6060843112-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-37">[</span><span class="o">-</span><span class="mf">0.15436960756778717</span><span class="p" data-group-id="6060843112-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6060843112-38">[</span><span class="mf">0.18355509638786316</span><span class="p" data-group-id="6060843112-38">]</span><span class="w">
      </span><span class="p" data-group-id="6060843112-34">]</span><span class="w">
    </span><span class="p" data-group-id="6060843112-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6060843112-27">}</span><span class="w">
</span><span class="p" data-group-id="6060843112-1">}</span></code></pre><p>You may access and update any portion of the loop state. Keep in mind that event handlers are <strong>not</strong> JIT-compiled, so you should be certain to manually JIT-compile any long-running or expensive operations.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="writing_custom_metrics.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Writing custom metrics
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="onnx_to_axon.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Converting ONNX models to Axon
        </span>
      </a>

  </div>
</div>
      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.3.0" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/axon/0.3.0" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/axon/0.3.0/show/guides/training_and_evaluation/writing_custom_event_handlers.livemd">(current file)</a>

            </span>

            <button class="a-main line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.6) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
